<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Whisper-WA | بناء التقرير</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
  <div class="animated-bg-logo">
    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Background Logo">
  </div>

  <div class="main-container">
    <div id="header-placeholder"></div>

    <div class="workspace-grid">
      <aside class="glass-panel report-sidebar">
        <div class="sidebar-header">
          <h3 id="txt-draft-title"><i class="fa-solid fa-file-contract"></i> مسودة التقرير</h3>
          <div class="sidebar-actions">
            <button class="btn-secondary" id="btn-export" type="button">
              <i class="fa-solid fa-file-arrow-down"></i> <span id="txt-export">تنزيل التقرير</span>
            </button>
            <a class="btn-secondary" id="btn-analysis" href="/analysis">
              <i class="fa-solid fa-magnifying-glass-chart"></i> <span id="txt-analysis">تحليل</span>
            </a>
            <a class="btn-secondary" id="btn-view" href="/reports">
              <i class="fa-solid fa-eye"></i> <span id="txt-view">عرض التقرير</span>
            </a>
          </div>
        </div>

        <button class="btn-primary full-width mb-10" id="txt-add-btn" type="button">
          <i class="fa-solid fa-plus-circle"></i> إضافة للتقرير الحالي
        </button>

        <div class="report-table-wrap">
          <table class="report-table" id="reportTable">
            <thead>
              <tr>
                <th id="th-msg">الرسالة</th>
                <th id="th-type">النوع</th>
                <th id="th-num">الرقم</th>
                <th id="th-time">التاريخ والوقت</th>
              </tr>
            </thead>
            <tbody id="reportTbody"></tbody>
          </table>
        </div>
      </aside>

      <section class="glass-panel chat-interface">
        <div class="search-area">
          <div class="search-input-wrapper">
            <i class="fa-solid fa-search"></i>
            <input type="text" id="inp-search" placeholder="بحث في المحادثات...">
          </div>
        </div>
        <div class="chat-split-view">
          <div class="chat-list">
            <div class="chat-item active" data-chat-id="chat1">
              <input type="checkbox" checked>
              <div class="chat-info">
                <h4>خالد (المشتبه به)</h4>
                <p>وينك؟ تأخرت...</p>
              </div>
              <span class="time">10:15</span>
            </div>
          </div>
          <div class="message-view" id="messageView"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // الجافا سكريبت كما هو (بدون تعديل)
    const chatsData = [{ id: "chat1", number: "055xxxx", name: "خالد (المشتبه به)", messages: [{ id: "m1", text: "وينك؟ تأخرت علي.", type: "received", datetime: "2026-02-12 10:15" }, { id: "m2", text: "واصل قريب، لا تشيل هم.", type: "sent", datetime: "2026-02-12 10:16" }]}];
    let selectedChatId = "chat1";
    const selectedMessageIds = new Set();
    const tbody = document.getElementById('reportTbody');
    const messageView = document.getElementById('messageView');

    function renderMessages(chatId) {
      const chat = chatsData.find(c => c.id === chatId);
      if (!chat) return;
      messageView.innerHTML = "";
      chat.messages.forEach((m) => {
        const box = document.createElement('div');
        box.className = `msg ${m.type}`;
        box.dataset.msgId = m.id;
        box.innerHTML = `<p>${m.text}</p><span class="msg-time">${m.datetime.split(" ")[1]}</span>`;
        box.addEventListener('click', () => {
          const id = box.dataset.msgId;
          if (selectedMessageIds.has(id)) { selectedMessageIds.delete(id); box.classList.remove('selected'); }
          else { selectedMessageIds.add(id); box.classList.add('selected'); }
        });
        messageView.appendChild(box);
      });
    }
    renderMessages(selectedChatId);
    
    // سكريبت الهيدر
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("header.html");
        const html = await res.text();
        document.getElementById("header-placeholder").innerHTML = html;
      } catch (e) { console.error(e); }
    });
  </script>
</body>
</html>
