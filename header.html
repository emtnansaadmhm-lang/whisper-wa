<header class="topbar">
  <div class="left">
    <!-- Back button -->
    <button class="icon-btn" id="btnBack" type="button" title="Back">
      <i class="fa-solid fa-arrow-left"></i>
    </button>

    <div class="brand">
      <img src="logo.png" class="logo" alt="Whisper-WA Logo" />
      <div class="brand-text">
        <b>Whisper-WA</b>
        <span>Digital Forensics Platform</span>
      </div>
    </div>
  </div>

  <div class="right">
    <!-- Account Dropdown -->
    <div class="dropdown" id="accountDropdown">
      <button class="avatar-btn" id="btnAccount" type="button" aria-haspopup="menu" aria-expanded="false" title="Account">
        <div class="avatar-fallback">
          <i class="fa-solid fa-user"></i>
        </div>
      </button>

      <div class="menu" id="accountMenu" role="menu" aria-hidden="true">
        <a class="menu-item" href="settings.html" role="menuitem">
          <i class="fa-solid fa-gear"></i>
          <span>Settings</span>
        </a>

        <button class="menu-item" id="menuLogout" type="button" role="menuitem">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Logout</span>
        </button>
      </div>
    </div>
  </div>
</header>

<style>
  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 18px;
    border-radius:16px;
    background:rgba(20,40,30,0.65);
    border:1px solid rgba(95,191,122,0.3);
    backdrop-filter: blur(12px);
    box-shadow:0 4px 20px rgba(0,0,0,0.22);
    gap:14px;
  }
  .left{ display:flex; align-items:center; gap:12px; }
  .right{ display:flex; align-items:center; gap:10px; }

  .brand{ display:flex; align-items:center; gap:12px; }
  .logo{ height:42px; width:auto; filter: drop-shadow(0 0 6px rgba(63,155,95,0.5)); }

  .brand-text{ display:flex; flex-direction:column; line-height:1.1; }
  .brand-text b{ color:#fff; font-size:1.1rem; }
  .brand-text span{ color:#c2dec9; font-size:0.85rem; margin-top:4px; }

  .icon-btn{
    width:40px; height:40px;
    display:inline-flex; align-items:center; justify-content:center;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.14);
    color:#c2dec9;
    cursor:pointer;
    transition:0.25s;
  }
  .icon-btn:hover{
    background: rgba(95,191,122,0.12);
    color:#8fd9a8;
    transform: translateY(-1px);
  }

  .dropdown{ position:relative; }
  .avatar-btn{
    width:42px; height:42px;
    border-radius:999px;
    border:1px solid rgba(95,191,122,0.35);
    background: rgba(0,0,0,0.14);
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    transition:0.25s;
    padding:0;
  }
  .avatar-btn:hover{
    background: rgba(95,191,122,0.12);
    transform: translateY(-1px);
  }

  .avatar-fallback{
    width:100%; height:100%;
    border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    color:#8fd9a8;
  }

  .menu{
    position:absolute;
    top:52px;
    inset-inline-end: 0;
    min-width: 180px;
    background: rgba(20,40,30,0.92);
    border: 1px solid rgba(95,191,122,0.30);
    border-radius: 14px;
    backdrop-filter: blur(14px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    padding: 8px;
    display:none;
    z-index: 999;
  }
  .menu.open{ display:block; }

  .menu-item{
    width:100%;
    border:0;
    background: transparent;
    color:#c2dec9;
    text-decoration:none;
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px 10px;
    border-radius: 12px;
    cursor:pointer;
    transition:0.2s;
    font-family: inherit;
    font-weight: 800;
    text-align: start;
  }
  .menu-item:hover{
    background: rgba(95,191,122,0.14);
    color:#8fd9a8;
  }

  @media (max-width: 520px){
    .brand-text span{ display:none; }
  }
</style>

<script>
(function(){
  // عناصر
  const backBtn = document.getElementById("btnBack");
  const btnAccount = document.getElementById("btnAccount");
  const menu = document.getElementById("accountMenu");
  const logoutBtn = document.getElementById("menuLogout");

  // حماية لو عنصر ناقص
  if (!backBtn || !btnAccount || !menu) return;

  // ========= Dropdown =========
  function setMenu(open){
    menu.classList.toggle("open", open);
    btnAccount.setAttribute("aria-expanded", open ? "true" : "false");
    menu.setAttribute("aria-hidden", open ? "false" : "true");
  }

  btnAccount.addEventListener("click", (e) => {
    e.stopPropagation();
    setMenu(!menu.classList.contains("open"));
  });

  document.addEventListener("click", () => setMenu(false));
  menu.addEventListener("click", (e) => e.stopPropagation());

  // ========= Logout =========
  if (logoutBtn){
    logoutBtn.addEventListener("click", () => {
      // إذا عندكم auth.html بدل index.html غيريها هنا
      window.location.href = "index.html";
    });
  }

  // ========= Back Button Routes =========
  const file = (location.pathname.split("/").pop() || "").toLowerCase();

  // اعتبري هذي أسماء صفحات الكونكت (عدّلي إذا ملفك اسمه غير)
  const CONNECT_PAGES = ["connect.html", "connected.html"];

  if (CONNECT_PAGES.includes(file)) {
    // صفحة الكونكت بدون سهم
    backBtn.style.display = "none";
    return;
  }

  if (file === "chat.html") {
    backBtn.style.display = "inline-flex";
    backBtn.onclick = () => window.location.href = "connect.html";
  }
  else if (file === "analysis.html") {
    backBtn.style.display = "inline-flex";
    backBtn.onclick = () => window.location.href = "chat.html";
  }
  else if (file === "reports.html") {
    backBtn.style.display = "inline-flex";
    backBtn.onclick = () => window.location.href = "chat.html";
  }
  else {
    // أي صفحة ثانية: بدون سهم
    backBtn.style.display = "none";
  }
})();
</script>
