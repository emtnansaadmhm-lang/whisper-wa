<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Whisper-WA | Connect</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary-dark:#1f5f3b;
      --primary-mid:#3f9b5f;
      --primary-light:#5fbf7a;
      --accent-glow:#8fd9a8;
      --bg-dark:#0e1a12;
      --glass-bg: rgba(20, 40, 30, 0.65);
      --glass-border: rgba(95, 191, 122, 0.3);
      --text-white:#ffffff;
      --text-muted:#c2dec9;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Tajawal',sans-serif;
      background: var(--bg-dark);
      color: var(--text-white);
      height:100vh;
      overflow:hidden;
      background-image:
        linear-gradient(rgba(31,95,59,0.10) 1px, transparent 1px),
        linear-gradient(90deg, rgba(31,95,59,0.10) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    .animated-bg-logo{
      position:fixed;top:50%;left:50%;
      transform:translate(-50%,-50%);
      z-index:-1;width:520px;opacity:.22;pointer-events:none;
      animation:pulse 8s ease-in-out infinite alternate;
    }
    .animated-bg-logo img{width:100%;filter:drop-shadow(0 0 30px var(--primary-mid))}
    @keyframes pulse{
      0%{opacity:.14;transform:translate(-50%,-50%) scale(.95)}
      100%{opacity:.34;transform:translate(-50%,-50%) scale(1.05)}
    }

    .page{
      height:100vh;
      display:flex;
      flex-direction:column;
      padding:25px;
      gap:20px;
    }

    header{
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      padding: 12px 20px;
      border-radius: 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow: 0 4px 20px rgba(0,0,0,.2);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:42px;filter:drop-shadow(0 0 6px var(--primary-mid))}
    .brand h3{font-size:1.2rem}
    .badge{
      display:inline-block;
      margin-top:3px;
      font-size:.8rem;
      padding:4px 10px;
      border-radius:6px;
      color: var(--accent-glow);
      background: var(--primary-dark);
      border:1px solid var(--primary-mid);
    }

    .nav{display:flex;gap:14px;align-items:center}
    .nav a{
      color: var(--text-muted);
      text-decoration:none;
      font-weight:700;
      transition:.2s;
    }
    .nav a:hover{color: var(--primary-light); transform: translateY(-1px);}
    .nav a.active{
      color: var(--accent-glow);
      border-bottom:2px solid var(--accent-glow);
      padding-bottom:3px;
    }

    main{
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .card{
      width:min(740px, 92vw);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(15px);
      border-radius: 22px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }

    .title{font-size:1.55rem;color:var(--accent-glow);margin-bottom:8px}
    .sub{color:var(--text-muted);line-height:1.6;margin-bottom:16px}

    .tabs{display:flex;gap:10px;margin-bottom:14px}
    .tabs button{
      flex:1;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: var(--text-muted);
      cursor:pointer;
      font-weight:800;
      transition:.2s;
    }
    .tabs button.active{
      background: rgba(95,191,122,.15);
      border-color: var(--glass-border);
      color: var(--accent-glow);
    }

    .tab{display:none}
    .tab.active{display:block}

    label{display:block;color:var(--text-muted);font-weight:800;margin:8px 0}
    input, select{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--glass-border);
      background: rgba(0,0,0,.28);
      color:white;
      outline:none;
      font-size:1rem;
    }
    input::placeholder{color:rgba(194,222,201,.7)}
    .hint{margin-top:10px;color:rgba(194,222,201,.85);font-size:.9rem}

    .actions{display:flex;gap:12px;margin-top:16px}
    .btn{
      flex:1;
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      border:none;
      transition:.2s;
    }
    .btn.primary{
      color:white;
      background: linear-gradient(45deg, var(--primary-dark), var(--primary-mid));
    }
    .btn.primary:hover{filter:brightness(1.15);transform:translateY(-1px)}
    .btn.ghost{
      background: rgba(0,0,0,.18);
      color: var(--accent-glow);
      border:1px solid rgba(255,255,255,.10);
    }
    .btn.ghost:hover{background: rgba(95,191,122,.12)}

    .alert{
      margin-top:14px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      font-weight:800;
      display:none;
    }
    .alert.info{display:block;background:rgba(63,155,95,.12);color:var(--accent-glow)}
    .alert.success{display:block;background:rgba(95,191,122,.15);color:#dffbe7}
    .alert.danger{display:block;background:rgba(255,107,107,.14);color:#ffd2d2;border-color:rgba(255,107,107,.35)}

    .device, .progress{
      margin-top:14px;
      padding:14px;
      border-radius:16px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
      display:none;
    }
    .device.show, .progress.show{display:block}

    .row{display:flex;justify-content:space-between;padding:6px 0;color:var(--text-muted)}
    .row b{color:white}

    .step{display:flex;align-items:center;gap:10px;padding:8px 0;color:var(--text-muted);font-weight:800}
    .dot{
      width:12px;height:12px;border-radius:50%;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.18);
    }
    .dot.running{background: rgba(143,217,168,.35); border-color: rgba(143,217,168,.65); box-shadow: 0 0 10px rgba(143,217,168,.35);}
    .dot.done{background: rgba(95,191,122,.9); border-color: rgba(95,191,122,1); box-shadow: 0 0 12px rgba(95,191,122,.45);}
  </style>
</head>

<body>
  <div class="animated-bg-logo"><img src="logo.png" alt=""></div>

  <div class="page">
    <header>
      <div class="brand">
        <img src="logo.png" alt="logo">
        <div>
          <h3>Whisper-WA</h3>
          <span class="badge">Case #: 055xxx</span>
        </div>
      </div>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a class="active" href="connect.html">Connect</a>
        <a href="chat.html">Chats</a>
        <a href="reports.html">Reports</a>
      </nav>
    </header>

    <main>
      <section class="card">
        <div class="title">Connect Device</div>
        <div class="sub">Enter IP:PORT or connect using USB. (Demo UI — backend later)</div>

        <div class="tabs">
          <button class="active" id="tabIpBtn">Wi-Fi (IP:PORT)</button>
          <button id="tabUsbBtn">USB</button>
        </div>

        <div class="tab active" id="tabIp">
          <label for="ip">Device IP:PORT</label>
          <input id="ip" type="text" placeholder="192.168.1.20:5555">
          <div class="hint">Demo: just type anything then Connect.</div>
        </div>

        <div class="tab" id="tabUsb">
          <label for="usb">USB Device</label>
          <select id="usb">
            <option value="">Select device (Demo)</option>
            <option value="d1">Android Device — demo</option>
          </select>
          <div class="hint">Real: this will be loaded from ADB devices list.</div>
        </div>

        <div class="actions">
          <button class="btn primary" id="connectBtn">Connect</button>
          <button class="btn ghost" id="prevBtn">View Previous Chats</button>
        </div>

        <div class="alert" id="alertBox"></div>

        <div class="device" id="deviceBox">
          <div class="row"><span>Model:</span> <b id="m">—</b></div>
          <div class="row"><span>Android:</span> <b id="v">—</b></div>
          <div class="row"><span>Root:</span> <b id="r">—</b></div>
        </div>

        <div class="progress" id="progressBox">
          <div class="step"><span class="dot" id="s1"></span> ADB Connection</div>
          <div class="step"><span class="dot" id="s2"></span> Pull Evidence (Key + DB)</div>
          <div class="step"><span class="dot" id="s3"></span> SHA-256 Hashing</div>
          <div class="step"><span class="dot" id="s4"></span> Decryption</div>
          <div class="step"><span class="dot" id="s5"></span> Analysis & Extraction</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const tabIpBtn = document.getElementById("tabIpBtn");
    const tabUsbBtn = document.getElementById("tabUsbBtn");
    const tabIp = document.getElementById("tabIp");
    const tabUsb = document.getElementById("tabUsb");

    const alertBox = document.getElementById("alertBox");
    const deviceBox = document.getElementById("deviceBox");
    const progressBox = document.getElementById("progressBox");

    const m = document.getElementById("m");
    const v = document.getElementById("v");
    const r = document.getElementById("r");

    const connectBtn = document.getElementById("connectBtn");
    const prevBtn = document.getElementById("prevBtn");

    // غيّريها لو تبين تجربة "مو مروت"
    const DEMO_IS_ROOTED = true;

    function setAlert(type, text){
      alertBox.className = "alert " + type;
      alertBox.textContent = text;
    }

    function resetDots(){
      ["s1","s2","s3","s4","s5"].forEach(id=>{
        document.getElementById(id).className = "dot";
      });
    }

    function dot(id, state){
      document.getElementById(id).classList.add(state);
    }

    function sleep(ms){ return new Promise(res=>setTimeout(res, ms)); }

    function switchTab(isIp){
      tabIpBtn.classList.toggle("active", isIp);
      tabUsbBtn.classList.toggle("active", !isIp);
      tabIp.classList.toggle("active", isIp);
      tabUsb.classList.toggle("active", !isIp);

      alertBox.className = "alert";
      alertBox.textContent = "";
      deviceBox.classList.remove("show");
      progressBox.classList.remove("show");
      resetDots();
    }

    tabIpBtn.onclick = ()=>switchTab(true);
    tabUsbBtn.onclick = ()=>switchTab(false);

    async function runPipeline(){
      progressBox.classList.add("show");

      dot("s1","running"); await sleep(600); dot("s1","done");
      dot("s2","running"); await sleep(800); dot("s2","done");
      dot("s3","running"); await sleep(650); dot("s3","done");
      dot("s4","running"); await sleep(850); dot("s4","done");
      dot("s5","running"); await sleep(850); dot("s5","done");

      setAlert("success", "Completed (Demo). Redirecting to Chats...");
      await sleep(700);
      window.location.href = "chat.html";
    }

    connectBtn.onclick = async ()=>{
      // تحقق بسيط
      const isIp = tabIpBtn.classList.contains("active");
      if(isIp){
        const ip = document.getElementById("ip").value.trim();
        if(!ip) return setAlert("danger","Please enter IP:PORT.");
      }else{
        const usb = document.getElementById("usb").value;
        if(!usb) return setAlert("danger","Please select a USB device.");
      }

      deviceBox.classList.add("show");
      m.textContent = "Android (Demo Device)";
      v.textContent = "13";
      r.textContent = DEMO_IS_ROOTED ? "Rooted ✅" : "Not Rooted ❌";

      if(!DEMO_IS_ROOTED){
        return setAlert("danger","Device is not rooted. This tool requires root to continue.");
      }

      setAlert("info","Connected (Demo). Running forensic pipeline...");
      connectBtn.disabled = true;
      prevBtn.disabled = true;

      resetDots();
      try{
        await runPipeline();
      }finally{
        connectBtn.disabled = false;
        prevBtn.disabled = false;
      }
    };

    prevBtn.onclick = ()=> window.location.href = "chat.html";
  </script>
</body>
</html>
